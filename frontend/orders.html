<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Orders - Demo Mini Ecommerce</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:
      radial-gradient(1200px 600px at 10% 10%, rgba(255,255,255,0.03), transparent 10%),
      radial-gradient(1000px 500px at 90% 90%, rgba(255,255,255,0.02), transparent 10%),
      linear-gradient(135deg,#0f1724 0%, #0b1a2b 50%, #05202e 100%);color:#e6eef6}
    .container{max-width:1100px;margin:0 auto;padding:20px}
    .page-title{margin:18px 0;font-size:2rem;font-weight:700;color:#fff;text-shadow:0 6px 30px rgba(3,7,18,.6)}
    .summary{margin-bottom:12px;color:#cfe7ff}
    .orders{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}
    .card{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08);padding:12px;border-radius:12px;box-shadow:0 6px 24px rgba(2,8,15,.45)}
    .meta{display:flex;justify-content:space-between;margin-bottom:8px}
    .items{font-size:14px;color:#cfe7ff}
    .total{color:#9ef0d1;font-weight:700;margin-top:8px}
  </style>
  <script src="header.js"></script>
</head>
<body>
  <div id="site-header"></div>
  <script>renderHeader('site-header');</script>
  <main class="container">
    <h2 class="page-title">Your Orders</h2>
    <div id="summary" class="summary"></div>
    <div id="orders" class="orders"></div>
  </main>
  <script>
    fetch('../backend/orders.php')
      .then(r=>r.text())
      .then(t=>{
        let data; try{ data = JSON.parse(t); }catch(e){ document.getElementById('orders').innerHTML = '<div>Server error</div>'; return; }
        if (!data || data.status !== 'success') {
          if (data && data.message === 'auth') { window.location.href = 'login.html'; return; }
          document.getElementById('orders').innerHTML = '<div>Failed to load orders</div>'; return;
        }
        document.getElementById('summary').textContent = 'User: ' + data.username + (data.role==='admin' ? ' (admin - showing all orders)' : '');
        const list = data.orders || [];
        if (!list.length) { document.getElementById('orders').innerHTML = '<div class="card">No orders yet.</div>'; return; }
        document.getElementById('orders').innerHTML = list.map(o=>{
          const items = (o.items||[]).map(i=>`${i.qty}× ${i.name} (₹${Number(i.price).toFixed(2)})`).join('<br>');
          return `<div class="card">
              <div class="meta"><div>#${o.id}</div><div>${new Date(o.created_at).toLocaleString()}</div></div>
              <div>By: ${o.username}</div>
              <div class="items">${items}</div>
              <div class="total">Total: ₹${Number(o.total).toFixed(2)}</div>
            </div>`;
        }).join('');
      })
      .catch(()=>{ document.getElementById('orders').innerHTML = '<div>Network error</div>'; });
  </script>
</body>
</html>
